# ==========================================
# .github/workflows/fb-auto-publisher.yml
# GitHub Actions Workflow - Multi Images + Link
# ==========================================
name: Facebook Auto Publisher (Multi Images)

on:
  schedule:
    # Test: ogni 5 minuti
    - cron: "*/5 * * * *"
    # Produzione: decommentare sotto
    # - cron: '0 9,15 * * *'  # 9:00 e 15:00 UTC (10:00 e 16:00 Italia inverno)
  
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸš€ Run Facebook Auto Publisher
        env:
          # ========================================
          # DATABASE
          # ========================================
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_PORT: ${{ secrets.DB_PORT }}
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          
          # ========================================
          # FACEBOOK
          # ========================================
          FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
          FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
          
          # ========================================
          # MESSENGER LINK
          # Include nel testo dei post, Facebook lo rende cliccabile
          # Non usare come parametro API (nasconderebbe le immagini!)
          # ========================================
          MESSENGER_LINK: "https://m.me/875722978961810"
          
          # ========================================
          # WHATSAPP (numero per link nel testo)
          # ========================================
          WHATSAPP_NUMBER: "393407346239"
          
          # ========================================
          # CONFIGURAZIONE PUBBLICAZIONE
          # ========================================
          MAX_POSTS: "5"
          
        run: |
          python fb_auto_publisher.py
      
      - name: ğŸ“‹ Upload logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: fb-publisher-logs
          path: fb_publisher.log
          retention-days: 7

# ==========================================
# ğŸ“š COME FUNZIONA - MULTI IMAGES + LINK
# ==========================================
#
# IMPORTANTE: Link NEL TESTO, non come parametro API!
# Questo assicura che le immagini siano sempre visibili.
#
# RISULTATO SU FACEBOOK:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ ğŸš— Mercedes GLA (2014)              â”‚
# â”‚ ğŸ’° 10.990 â‚¬ | ğŸ“ 222.000 km         â”‚
# â”‚ [...Altro]                          â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ [ğŸ“· 1] [ğŸ“· 2] [ğŸ“· 3] [ğŸ“· 4]        â”‚ â† CAROUSEL
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ [Espandi per vedere tutto]          â”‚
# â”‚                                     â”‚
# â”‚ ğŸ’¬ CONTATTACI SU MESSENGER:        â”‚
# â”‚ ğŸ‘‰ m.me/875722978961810 â† CLICK!   â”‚ â† LINK CLICCABILE
# â”‚                                     â”‚
# â”‚ ğŸ“± Oppure su WhatsApp:             â”‚
# â”‚ ğŸ‘‰ wa.me/393407346239              â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# VANTAGGI:
# âœ… Fino a 4 immagini in carousel scorrevole
# âœ… Link Messenger cliccabile nel testo
# âœ… Link WhatsApp alternativo
# âœ… Nessun conflitto con link preview
# âœ… Le immagini sono SEMPRE visibili
# âœ… Mobile-friendly (link facile da tappare)
#
# ==========================================
# ğŸ—‚ï¸ REQUISITI DATABASE
# ==========================================
#
# La tabella auto_vetrina deve avere questi campi:
# - immagine_principale (VARCHAR/TEXT)
# - immagine_2 (VARCHAR/TEXT)
# - immagine_3 (VARCHAR/TEXT)
# - immagine_4 (VARCHAR/TEXT)
#
# Se hai solo immagine_principale, lo script funziona ugualmente
# con una sola immagine.
#
# Per aggiungere i campi mancanti (se necessario):
#
# ALTER TABLE auto_vetrina 
#   ADD COLUMN immagine_2 TEXT NULL AFTER immagine_principale,
#   ADD COLUMN immagine_3 TEXT NULL AFTER immagine_2,
#   ADD COLUMN immagine_4 TEXT NULL AFTER immagine_3;
#
# ==========================================
# ğŸ”§ COME TROVARE IL TUO MESSENGER LINK
# ==========================================
#
# Il link Messenger della tua pagina Ã¨:
# https://m.me/[PAGE_USERNAME]
#
# Esempio con Page ID numerico:
# https://m.me/875722978961810
#
# Per trovarlo:
# 1. Vai sulla tua Pagina Facebook
# 2. Clicca su "Informazioni"
# 3. Cerca "@username" o usa il Page ID
# 4. Link: https://m.me/[USERNAME_O_ID]
#
# Oppure clicca sul pulsante "Messaggio" sulla tua pagina
# e copia il link che si apre.
#
# ==========================================
# ğŸ“… SCHEDULE ALTERNATIVI
# ==========================================
#
# Due volte al giorno (consigliato):
# - cron: '0 9,15 * * *'
#
# Una volta al giorno:
# - cron: '0 10 * * *'
#
# Tre volte al giorno:
# - cron: '0 9,13,17 * * *'
#
# Solo giorni feriali:
# - cron: '0 10 * * 1-5'
#
# Ogni 4 ore:
# - cron: '0 */4 * * *'
#
# Tool: https://crontab.guru/
