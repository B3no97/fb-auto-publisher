# ==========================================
# .github/workflows/fb-auto-publisher.yml
# GitHub Actions Workflow - CTA Optimized
# ==========================================
name: Facebook Auto Publisher (CTA)

on:
  schedule:
    # Test: ogni 5 minuti
    - cron: "*/5 * * * *"
    # Produzione: decommentare sotto
    # - cron: '0 9,15 * * *'  # 9:00 e 15:00 UTC (10:00 e 16:00 Italia inverno)
  
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸš€ Run Facebook Auto Publisher
        env:
          # ========================================
          # DATABASE
          # ========================================
          DB_HOST: ${{ secrets.DB_HOST }}
          DB_PORT: ${{ secrets.DB_PORT }}
          DB_NAME: ${{ secrets.DB_NAME }}
          DB_USER: ${{ secrets.DB_USER }}
          DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
          
          # ========================================
          # FACEBOOK
          # ========================================
          FB_PAGE_ID: ${{ secrets.FB_PAGE_ID }}
          FB_ACCESS_TOKEN: ${{ secrets.FB_ACCESS_TOKEN }}
          
          # ========================================
          # SCELTA CTA (scegli UNA delle 3 opzioni)
          # ========================================
          
          # OPZIONE 1: MESSENGER (CONSIGLIATA) âœ…
          # Pulsante "Messaggio" che apre Messenger
          # Funziona sempre, nessuna autorizzazione richiesta
          CTA_TYPE: "MESSAGE_PAGE"
          CTA_LINK: "https://m.me/875722978961810"
          
          # OPZIONE 2: LINK AL SITO ğŸŒ
          # Pulsante "Scopri di piÃ¹" che porta al sito
          # Decommentare le 2 righe sotto e commentare OPZIONE 1
          # CTA_TYPE: "LEARN_MORE"
          # CTA_LINK: "https://www.mc-auto.it"
          
          # OPZIONE 3: CONTATTACI ğŸ“
          # Pulsante "Contattaci" che porta al sito
          # Decommentare le 2 righe sotto e commentare OPZIONE 1
          # CTA_TYPE: "CONTACT_US"
          # CTA_LINK: "https://www.mc-auto.it/contatti"
          
          # ========================================
          # WHATSAPP (numero per link nel testo)
          # ========================================
          WHATSAPP_NUMBER: "393407346239"
          
          # ========================================
          # CONFIGURAZIONE PUBBLICAZIONE
          # ========================================
          MAX_POSTS: "5"
          
        run: |
          python fb_auto_publisher.py
      
      - name: ğŸ“‹ Upload logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: fb-publisher-logs
          path: fb_publisher.log
          retention-days: 7

# ==========================================
# ğŸ“š GUIDA SCELTA CTA
# ==========================================
#
# 1ï¸âƒ£ MESSAGE_PAGE (Messenger) - CONSIGLIATA âœ…
#    PerchÃ©: 
#    - Funziona sempre senza setup
#    - Pulsante "Messaggio" molto visibile
#    - L'utente resta su Facebook
#    - Conversazione immediata
#    Quando: Sempre, Ã¨ la scelta migliore
#
# 2ï¸âƒ£ LEARN_MORE (Link sito) ğŸŒ
#    PerchÃ©:
#    - Porta traffico al sito
#    - Utile se hai form contatto o widget WhatsApp
#    Quando: Se vuoi che l'utente veda piÃ¹ info sul sito
#
# 3ï¸âƒ£ CONTACT_US (Contattaci) ğŸ“
#    PerchÃ©:
#    - Porta direttamente alla pagina contatti
#    - Utile se hai telefono/form/WhatsApp sul sito
#    Quando: Se hai una pagina contatti ottimizzata
#
# ==========================================
# âš¡ COME FUNZIONA
# ==========================================
#
# POST FACEBOOK:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ ğŸš— Mercedes GLA (2014)              â”‚
# â”‚ ğŸ’° 10.990 â‚¬ | ğŸ“ 222.000 km         â”‚ â† VISIBILE
# â”‚ â›½ Diesel â€¢ âš™ï¸ Automatico â€¢ âš¡ 136CV â”‚
# â”‚ [...Altro]                          â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ [IMMAGINE AUTO]                     â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚          ğŸ”µ [Messaggio] â†           â”‚ â† CTA BUTTON
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# VANTAGGI:
# âœ… Prezzo visibile prima del "...Altro"
# âœ… Km visibili immediatamente
# âœ… CTA button prominente sotto immagine
# âœ… Click â†’ conversazione immediata
#
# ==========================================
# ğŸ”§ MESSENGER: COME TROVARE IL TUO LINK
# ==========================================
#
# Il link Messenger della tua pagina Ã¨:
# https://m.me/[PAGE_USERNAME]
#
# Esempio con Page ID numerico:
# https://m.me/875722978961810
#
# Per trovarlo:
# 1. Vai sulla tua Pagina Facebook
# 2. Clicca su "Informazioni"
# 3. Cerca "@username" o usa il Page ID
# 4. Link: https://m.me/[USERNAME_O_ID]
#
# ==========================================
# ğŸ“… SCHEDULE ALTERNATIVI
# ==========================================
#
# Due volte al giorno (consigliato):
# - cron: '0 9,15 * * *'
#
# Una volta al giorno:
# - cron: '0 10 * * *'
#
# Tre volte al giorno:
# - cron: '0 9,13,17 * * *'
#
# Solo giorni feriali:
# - cron: '0 10 * * 1-5'
#
# Ogni 4 ore:
# - cron: '0 */4 * * *'
#
# Tool: https://crontab.guru/
